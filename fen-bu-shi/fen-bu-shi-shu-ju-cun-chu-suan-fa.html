<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式数据存储算法 | PYY在线笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/study/img/logo.png">
    <meta name="description" content="PYY在线笔记">
    
    <link rel="preload" href="/study/assets/css/0.styles.f503b9f0.css" as="style"><link rel="preload" href="/study/assets/js/app.dc60e210.js" as="script"><link rel="preload" href="/study/assets/js/6.fceef279.js" as="script"><link rel="preload" href="/study/assets/js/31.99fb9619.js" as="script"><link rel="prefetch" href="/study/assets/js/10.7ed69d34.js"><link rel="prefetch" href="/study/assets/js/11.9448c32e.js"><link rel="prefetch" href="/study/assets/js/12.86c493c7.js"><link rel="prefetch" href="/study/assets/js/13.9ed58975.js"><link rel="prefetch" href="/study/assets/js/14.48e59348.js"><link rel="prefetch" href="/study/assets/js/15.b5bdf29c.js"><link rel="prefetch" href="/study/assets/js/16.7e65e129.js"><link rel="prefetch" href="/study/assets/js/17.d21d2357.js"><link rel="prefetch" href="/study/assets/js/18.ff6a09ec.js"><link rel="prefetch" href="/study/assets/js/19.4dd597a5.js"><link rel="prefetch" href="/study/assets/js/2.6082ecbd.js"><link rel="prefetch" href="/study/assets/js/20.13424f64.js"><link rel="prefetch" href="/study/assets/js/21.d0a93e41.js"><link rel="prefetch" href="/study/assets/js/22.3157d1d1.js"><link rel="prefetch" href="/study/assets/js/23.bf30424e.js"><link rel="prefetch" href="/study/assets/js/24.6e0cd257.js"><link rel="prefetch" href="/study/assets/js/25.85fbb512.js"><link rel="prefetch" href="/study/assets/js/26.c54e0c14.js"><link rel="prefetch" href="/study/assets/js/27.6da488a3.js"><link rel="prefetch" href="/study/assets/js/28.321038ce.js"><link rel="prefetch" href="/study/assets/js/29.3fe454c4.js"><link rel="prefetch" href="/study/assets/js/3.e7c144f8.js"><link rel="prefetch" href="/study/assets/js/30.2c2ed4ad.js"><link rel="prefetch" href="/study/assets/js/32.5aea4bba.js"><link rel="prefetch" href="/study/assets/js/33.8ed67f2e.js"><link rel="prefetch" href="/study/assets/js/34.4eb2a764.js"><link rel="prefetch" href="/study/assets/js/35.32c83c52.js"><link rel="prefetch" href="/study/assets/js/36.0e7c4410.js"><link rel="prefetch" href="/study/assets/js/37.029a3bab.js"><link rel="prefetch" href="/study/assets/js/38.9404c1e2.js"><link rel="prefetch" href="/study/assets/js/39.99a331b6.js"><link rel="prefetch" href="/study/assets/js/4.5e539c6c.js"><link rel="prefetch" href="/study/assets/js/40.68a12f82.js"><link rel="prefetch" href="/study/assets/js/41.f802eb8f.js"><link rel="prefetch" href="/study/assets/js/42.9353144d.js"><link rel="prefetch" href="/study/assets/js/43.58a525e4.js"><link rel="prefetch" href="/study/assets/js/44.d327c357.js"><link rel="prefetch" href="/study/assets/js/45.54dc5bdd.js"><link rel="prefetch" href="/study/assets/js/46.97eb4353.js"><link rel="prefetch" href="/study/assets/js/47.d0f5dd26.js"><link rel="prefetch" href="/study/assets/js/48.c71e0efd.js"><link rel="prefetch" href="/study/assets/js/49.c4bf96d9.js"><link rel="prefetch" href="/study/assets/js/5.49f21cfc.js"><link rel="prefetch" href="/study/assets/js/50.a9f40bc0.js"><link rel="prefetch" href="/study/assets/js/51.cb5601bb.js"><link rel="prefetch" href="/study/assets/js/52.f4b73d57.js"><link rel="prefetch" href="/study/assets/js/7.e9fa99bf.js"><link rel="prefetch" href="/study/assets/js/8.60f08f23.js"><link rel="prefetch" href="/study/assets/js/9.1ebd5ad9.js">
    <link rel="stylesheet" href="/study/assets/css/0.styles.f503b9f0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study/" class="home-link router-link-active"><img src="/study/img/logo.png" alt="PYY在线笔记" class="logo"> <span class="site-name can-hide">PYY在线笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study/技术方案/" class="nav-link">
  技术方案
</a></div><div class="nav-item"><a href="/study/Java技术栈/" class="nav-link">
  Java技术栈
</a></div><div class="nav-item"><a href="/study/分布式/" class="nav-link">
  分布式
</a></div><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/study/消息队列/" class="nav-link">
  消息队列
</a></div><div class="nav-item"><a href="/study/数据结构和算法/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/study/k8s/" class="nav-link">
  k8s
</a></div><div class="nav-item"><a href="/study/ServiceMesh/" class="nav-link">
  ServiceMesh
</a></div><div class="nav-item"><a href="/study/DevOps/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/study/总结/" class="nav-link">
  总结
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study/技术方案/" class="nav-link">
  技术方案
</a></div><div class="nav-item"><a href="/study/Java技术栈/" class="nav-link">
  Java技术栈
</a></div><div class="nav-item"><a href="/study/分布式/" class="nav-link">
  分布式
</a></div><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/study/消息队列/" class="nav-link">
  消息队列
</a></div><div class="nav-item"><a href="/study/数据结构和算法/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/study/k8s/" class="nav-link">
  k8s
</a></div><div class="nav-item"><a href="/study/ServiceMesh/" class="nav-link">
  ServiceMesh
</a></div><div class="nav-item"><a href="/study/DevOps/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/study/总结/" class="nav-link">
  总结
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Dev Ops</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java技术栈</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Service Mesh</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>K 8 S</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>分布式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study/fen-bu-shi/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/study/fen-bu-shi/rpc.html" class="sidebar-link">远程过程调用协议RPC(Remote Procedure Call)</a></li><li><a href="/study/fen-bu-shi/fen-bu-shi-shi-wu.html" class="sidebar-link">分布式事务</a></li><li><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html" aria-current="page" class="active sidebar-link">分布式数据存储算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_1-概念" class="sidebar-link">1 概念</a></li><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_2-hash算法" class="sidebar-link">2 hash算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_2-1-过程" class="sidebar-link">2.1 过程</a></li><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_2-2-缺点和使用现状" class="sidebar-link">2.2 缺点和使用现状</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_3-原始一致性hash算法" class="sidebar-link">3 原始一致性hash算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_3-1-过程" class="sidebar-link">3.1 过程</a></li><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_3-2-一致性hash算法的优点" class="sidebar-link">3.2 一致性hash算法的优点</a></li><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_3-3-一致性hash算法的缺点" class="sidebar-link">3.3 一致性hash算法的缺点</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_4-基于虚拟节点的一致性hash算法" class="sidebar-link">4 基于虚拟节点的一致性hash算法</a></li><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_5-redis-hash-slot算法" class="sidebar-link">5 redis hash slot算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_5-1-过程分析" class="sidebar-link">5.1 过程分析</a></li><li class="sidebar-sub-header"><a href="/study/fen-bu-shi/fen-bu-shi-shu-ju-cun-chu-suan-fa.html#_5-2-优缺点分析" class="sidebar-link">5.2 优缺点分析</a></li></ul></li></ul></li><li><a href="/study/fen-bu-shi/da-xing-hu-lian-wang-gong-si-fen-bu-shi-idfang-an.html" class="sidebar-link">大型互联网公司分布式ID方案总结</a></li><li><a href="/study/fen-bu-shi/nao-lie-shi-shi-me-.html" class="sidebar-link">脑裂是什么？Zookeeper是如何解决的</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>大数据</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术方案</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构和算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>消息队列</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="分布式数据存储算法"><a href="#分布式数据存储算法" class="header-anchor">#</a> 分布式数据存储算法</h1> <h2 id="_1-概念"><a href="#_1-概念" class="header-anchor">#</a> 1 概念</h2> <p>分布式数据存储中，数据是分布式在不同的服务器上的，那么每条数据应该存储到哪台服务器？取的时候又应该去哪台服务器去取？分布式数据存储算法就是解决此类问题的算法</p> <h2 id="_2-hash算法"><a href="#_2-hash算法" class="header-anchor">#</a> 2 hash算法</h2> <h3 id="_2-1-过程"><a href="#_2-1-过程" class="header-anchor">#</a> 2.1 过程</h3> <ol><li>客户端开始操作数据</li> <li>服务器对数据的key进行hash计算，得到一个数字</li> <li>服务器对得到的数字与服务器数量做取余计算，得到服务器的编号</li> <li>服务器在相应的服务器上进行操作</li></ol> <p>hash算法的数据存储过程图解：
<img src="/study/assets/img/image-20201029150210477.9b6ac465.png" alt="image-20201029150210477"></p> <h3 id="_2-2-缺点和使用现状"><a href="#_2-2-缺点和使用现状" class="header-anchor">#</a> 2.2 缺点和使用现状</h3> <ol><li>可能出现某个服务器上的<strong>热点数据特别多</strong>，导致该服务器出现性能瓶颈</li> <li>如果某个服务器<strong>出现故障</strong>，会导致<strong>大部分数据的hash错乱</strong>，导致大部分数据读写失效或错误</li></ol> <p>由于hash算法的上述缺点，现在很少有分布式数据存储使用该算法</p> <h2 id="_3-原始一致性hash算法"><a href="#_3-原始一致性hash算法" class="header-anchor">#</a> 3 原始一致性hash算法</h2> <h3 id="_3-1-过程"><a href="#_3-1-过程" class="header-anchor">#</a> 3.1 过程</h3> <ol><li>将服务器分布在一个圆环上</li> <li>客户端开始进行数据操作</li> <li>服务器对数据的key进行hash计算，得到一个数字</li> <li>用得到的hash值在圆环对应的各个点上去对比，得到数据在圆环上的落点</li> <li>服务器顺时针寻找距离该落点最近的一个服务器节点</li> <li>服务器在相应的服务器上进行操作</li></ol> <p>服务器分布样式图解：
<img src="/study/assets/img/image-20201029150245321.70603ece.png" alt="image-20201029150245321"></p> <h3 id="_3-2-一致性hash算法的优点"><a href="#_3-2-一致性hash算法的优点" class="header-anchor">#</a> 3.2 一致性hash算法的优点</h3> <p>如果某个服务器节点出现故障，只会导致该节点对应区间的数据出现错误，其他节点的数据仍然保存完整。</p> <h3 id="_3-3-一致性hash算法的缺点"><a href="#_3-3-一致性hash算法的缺点" class="header-anchor">#</a> 3.3 一致性hash算法的缺点</h3> <p>可能出现某个服务器上的热点数据特别多，导致该服务器出现性能瓶颈</p> <h2 id="_4-基于虚拟节点的一致性hash算法"><a href="#_4-基于虚拟节点的一致性hash算法" class="header-anchor">#</a> 4 基于虚拟节点的一致性hash算法</h2> <p>基于虚拟节点的一致性hash算法指的是在一致性hash算法的基础上，在每个虚拟节对应的区间上增加若干个其他节点的虚拟节点，这样就能最大限度的解决热点数据导致的服务器数据分布不均的问题</p> <p>基于虚拟节点的一致性hash算法图解：
<img src="/study/assets/img/image-20201029150300602.b9005542.png" alt="image-20201029150300602"></p> <h2 id="_5-redis-hash-slot算法"><a href="#_5-redis-hash-slot算法" class="header-anchor">#</a> 5 redis hash slot算法</h2> <h3 id="_5-1-过程分析"><a href="#_5-1-过程分析" class="header-anchor">#</a> 5.1 过程分析</h3> <p>redis hash slot算法是redis分布式中使用的分布式数据存储算法，他将数据存储在16384个hash槽中，然后再把这16384个hash槽平均分布在每个服务器上，这样用户进行数据操作，只需要找到数据对应的hash槽，然后再找到hash槽对应的服务器即可，整个过程如下：</p> <ol><li>客户端开始操作数据</li> <li>服务器对数据的key进行<strong>CRC16值</strong>计算，得到一个数字</li> <li>服务器对得到的数字与16384做取余计算，得到对应的hash槽编号</li> <li>根据hash槽找到对应的服务器</li> <li>服务器在相应的服务器上进行操作</li></ol> <h3 id="_5-2-优缺点分析"><a href="#_5-2-优缺点分析" class="header-anchor">#</a> 5.2 优缺点分析</h3> <ol><li>如果某个服务器节点出现故障，只会导致该服务器节点上对应的hash槽上的数据出现故障，不影响其他数据</li> <li>如果某个服务器节点出现故障，redis会迅速把该节点上的hash槽转移到其他服务器节点上（redis底层做了优化），保证把损失降低到最低</li> <li>由于存在16384个hash槽，所以很好的解决了局部数据热点问题。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study/fen-bu-shi/fen-bu-shi-shi-wu.html" class="prev">
        分布式事务
      </a></span> <span class="next"><a href="/study/fen-bu-shi/da-xing-hu-lian-wang-gong-si-fen-bu-shi-idfang-an.html">
        大型互联网公司分布式ID方案总结
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/study/assets/js/app.dc60e210.js" defer></script><script src="/study/assets/js/6.fceef279.js" defer></script><script src="/study/assets/js/31.99fb9619.js" defer></script>
  </body>
</html>
